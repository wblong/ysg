<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <title>洋山港</title>
    <!--bootstrap-->
    <link rel="stylesheet" href="dist/bootstrap.min.css">
     <!--ol-->
    <link rel="stylesheet" href="dist/ol.min.css">
    <!--ol-editor-->
    <link rel="stylesheet" href="dist/ol.editor.css">
    <!--ol-ex-search-->
	<link rel="stylesheet"  href="dist/ex/control/searchcontrol.css">
	<!--ol-ex-overlay-->
	<link rel="stylesheet"  href="dist/ex/control/popupoverlay.css">
	<link rel="stylesheet"  href="dist/ex/control/popupoverlay.anim.css">
    <!---->
    <link href="dist/bootstrap/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="dist/ex/control/layerpopupcontrol.css">
    <link rel="stylesheet" type="text/css" href="dist/ex/control/controlbar.css">
    	<!-- 脚本 -->
        <!--jquery-->
        <script src="dist/jquery.min.js"></script>
    	<script src="dist/bootstrap.min.js"></script>
        <!--proj4-->
        <script src="dist/proj4.js"></script>
        <!--ol-->
        <script src="dist/ol-debug.js"></script>
      	  <!--style 显示样式控制-->
        <script src="dist/styles.js"></script>
        <!--字符串格式化和日期格式化函数-->
        <script type="text/javascript" src="dist/exfunc.js"></script>
        
        <!--UI 条件过滤、搜索框、日期控件-->
		<link rel="stylesheet" type="text/css" href="dist/top_ui_bar.css">
        <script type="text/javascript" src="dist/top_ui_bar.js"></script>
		<script type="text/javascript" src="dist/DatePicker/WdatePicker.js"></script>

    	
        <!--ol-ex-->
    	<script src="dist/ex/control/searchcontrol.js"></script>
    	<script src="dist/ex/control/searchfeaturecontrol.js"></script>
    	<script src="dist/ex/control/popupoverlay.js"></script>
    	<script type="text/javascript" src="dist/ex/control/layerswitchercontrol.js"></script>
    	<script type="text/javascript" src="dist/ex/control/layerpopupcontrol.js"></script>
    	<script type="text/javascript" src="dist/ex/control/controlbar.js"></script>
    	<script type="text/javascript" src="dist/ex/control/buttoncontrol.js"></script>
    	<script type="text/javascript" src="dist/ex/control/togglecontrol.js"></script>

    	 <!--ol-editor-->
        <script src="dist/ol.editor.js"></script>
    	<!--video-->
    	<script src="dist/ex/control/videoPopupOverlay.js"></script>
    	
        <!--mq-->
        <script src="dist/rabbitmq/sockjs-0.3.js"></script>
        <script src="dist/rabbitmq/stomp.js"></script>
        <!--配置信息-->
		<script src="dist/config.js"></script>
  </head>
  <body>
    <div class="application pinned-toolbar pinned-layermanager">
		<!--地图容器-->
		<div class="map-container">
			
    		<!--属性管理器-->
			<!-- <div id="attributemanager" class="attributemanager">
        		<div class="bar-title">属性管理</div>
    		</div> -->
    		<!-- 地图 -->
			<div id="map" class="map" tabindex="-1" style="cursor:default">
				<!--图层管理按钮-->
				<div id="layer_manager">
					<div class="layer_manager">
						<button id="layer_manager_btn"></button>
					</div>	

				</div>
				<!--图层管理-->
				<div id="layermanager" class="layermanager">
	    		</div>
				<!--日期；类型控件-->
				<div id="query_condition">
					<ul>
						<li>
							<button id="filter"></button>
							<div class="content_panel">
								<div>
									开始时间:
									<input type="text" id="start_time"  class="Wdate" onFocus="WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM-dd HH:mm:ss',readOnly:true})">
									
								</div>
								<div>
									 结束时间:
									 <input type="text" id="end_time" class="Wdate" onFocus="WdatePicker({lang:'zh-cn',dateFmt:'yyyy-MM-dd HH:mm:ss',readOnly:true})">
									 
								</div>
								<div class="checkbutton">
									<div>
										<input type="checkbox"  id="camera" >像机
										<input type="checkbox"  id="jika" checked="true">车辆
										<input type="checkbox"  id="agv"> AGV
									</div>
									<div>
										<input type="checkbox"  id="ldiao">龙门吊
										<input type="checkbox"  id="qdiao">桥吊
										<input type="checkbox"  id="gdiao">轨道吊
									</div>
									<div>
										<input type="checkbox"  id="tirediao">轮胎吊
										<input type="checkbox"  id="qiuji">球机
										<input type="checkbox"  id="qiangji">枪机
									</div>
							    </div>
							</div>
						</li>
					</ul>
				</div>

    		<!--搜索框-->
				<div id="search">
					<div class="txt">
						<input type="text" id="query_string"><!-- 搜索按钮-->
						<a href="#" class="btn_query"><img src="res/search.png" ></a><!--搜索按钮-->
					</div>		
				</div>
			<!--查询结果栏-->
	    		<div id="tab-query">
	    			<ul class="first">
					  <li> 
						   <a href="#">摄像机</a>
						   <ul class="second">
								<li><a  href="##">西区全景</a>
									<div class="content">
										<p>姓名：张三</p>
										<p>驾照：3333333</p>
										<p>手机:182333333</p>
										<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
										  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
						  			</div>	
								</li>
								<li><a  href="##">西区球形机</a>
											<div class="content">
												<p>姓名：张三</p>
												<p>驾照：3333333</p>
												<p>手机:182333333</p>
												<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
												  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
								  			</div>	
								</li>
						   </ul>
					  </li>
					  <li> 
						   <a href="#">桥吊</a>
						   <ul class="second">
								<li><a  href="##">编号1</a>
									<div class="content">
										<p>姓名：张三</p>
										<p>驾照：3333333</p>
										<p>手机:182333333</p>
										<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
										  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
						  			</div>			
								</li>
								<li><a  href="##">编号2</a>	
									<div class="content">
										<p>姓名：李四</p>
										<p>驾照：3333333</p>
										<p>手机:182333333</p>
										<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
										  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
						  			</div>	
								</li>
						   </ul>
					  </li>
					  <li> 
						   <a href="#">集卡</a>
						   <ul class="second">
								<li><a  href="##">编号1</a>
									<div class="content">
										<p>姓名：张三</p>
										<p>驾照：3333333</p>
										<p>手机:182333333</p>
										<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
										  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
						  			</div>			
								</li>
								<li><a  href="##">编号2</a>	
									<div class="content">
										<p>姓名：李四</p>
										<p>驾照：3333333</p>
										<p>手机:182333333</p>
										<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
										  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
						  			</div>	
								</li>
						   </ul>
					  </li>
					    <li> 
					  	   <a href="#">AGV</a>
					  	   <ul class="second">
					  			<li><a  href="##">编号1</a>
					  				<div class="content">
					  					<p>姓名：张三</p>
					  					<p>驾照：3333333</p>
					  					<p>手机:182333333</p>
					  					<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					  					  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					  	  			</div>			
					  			</li>
					  			<li><a  href="##">编号2</a>	
					  				<div class="content">
					  					<p>姓名：李四</p>
					  					<p>驾照：3333333</p>
					  					<p>手机:182333333</p>
					  					<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					  					  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					  	  			</div>	
					  			</li>
					  	   </ul>
					    </li>
					      <li> 
					    	   <a href="#">球机</a>
					    	   <ul class="second">
					    			<li><a  href="##">西区全景</a>
					    				<div class="content">
					    					<p>姓名：张三</p>
					    					<p>驾照：3333333</p>
					    					<p>手机:182333333</p>
					    					<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					    					  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					    	  			</div>	
					    			</li>
					    			<li><a  href="##">西区球形机</a>
					    						<div class="content">
					    							<p>姓名：张三</p>
					    							<p>驾照：3333333</p>
					    							<p>手机:182333333</p>
					    							<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					    							  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					    			  			</div>	
					    			</li>
					    	   </ul>
					      </li>
					        <li> 
					      	   <a href="#">枪机</a>
					      	   <ul class="second">
					      			<li><a  href="##">西区全景</a>
					      				<div class="content">
					      					<p>姓名：张三</p>
					      					<p>驾照：3333333</p>
					      					<p>手机:182333333</p>
					      					<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					      					  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					      	  			</div>	
					      			</li>
					      			<li><a  href="##">西区球形机</a>
					      						<div class="content">
					      							<p>姓名：张三</p>
					      							<p>驾照：3333333</p>
					      							<p>手机:182333333</p>
					      							<p>desc:tesgghaglafahidfidfdifhdifhdif djfhdfdif
					      							  hdifhdifhdi fidfhidi dhfdihdfhdihidfhdihihdi</p>
					      			  			</div>	
					      			</li>
					      	   </ul>
					        </li>
	    			</ul>
	    			
	    		</div><!--查询结果栏-->

			</div><!-- 地图 -->
			
		</div><!--地图容器-->
		<!-- 状态栏 -->
     	<div id="statusbar" class="statusbar"></div>
    </div>
	<!--脚本函数-->
	<script>
		//选择
		var selectClick=new ol.interaction.Select({
			
		});
		
	    //var attributeManager=new ol.control.AttributeManager({ target: 'attributemanager' });
	    // proj4.defs("EPSG:23700","+title=HD72 EOV +proj=somerc +lat_0=47.14439372222222 +lon_0=19.04857177777778 +k_0=0.99993 +x_0=650000 +y_0=200000 +ellps=GRS67 +towgs84=52.17,-71.82,-14.9,0,0,0,0 +units=m +no_defs");
	    var eov = new ol.proj.Projection({
	        code: 'EPSG:3857',
	        extent: [13582066.888853556, 3587359.445355572,
                    13585173.06488047, 3588705.080676691],
	        worldExtent: [73,3, 135, 53]
	    });
	    //动态图层
	    var realTimeLayer=new ol.layer.Vector({
	    	name:'动态图层',
	    	source:new ol.source.Vector({
                    url:"data/camera_.geojson",
                    format:new ol.format.GeoJSON()}),
	    	style:styleFunction
	    });
	    //realTimeLayer.set('class_','geomcollection');
	    realTimeLayer.set('id','realTimeLayerID');
	    // //加载要素图层
	    // var bridgeCraneLayer=new ol.layer.Vector({
	    // 	name:'桥吊',
	    // 	source:new ol.source.Vector(),
	    // 	style:styleFunction
	    // });

	    // loadData(bridgeCraneUrl,bridgeCraneLayer);
	    // var gantryCraneLayer=new ol.layer.Vector({
	    // 	name:'龙门吊',
	    // 	source:new ol.source.Vector(),
	    // 	style:styleFunction
	    // });

	    // loadData(gantryCraneUrl,gantryCraneLayer);
	    // var trackCraneLayer=new ol.layer.Vector({
	    // 	name:'轨道吊',
	    // 	source:new ol.source.Vector(),
	    // 	style:styleFunction
	    // });

	    // loadData(trackCraneUrl,trackCraneLayer);

	    // var carsLayer=new ol.layer.Vector({
	    // 	name:'车辆',
	    // 	source:new ol.source.Vector(),
	    // 	style:styleFunction
	    // });
	    // loadData(carsUrl,carsLayer);
	    // var camerasLayer=new ol.layer.Vector({
	    // 	name:'像机',
	    // 	source:new ol.source.Vector(),
	    // 	style:styleFunction
	    // });
	    // loadData(camerasUrl,camerasLayer);
	    //search
	    var search = new ol.control.SearchFeature(
		{	
			//target: $("#search").get(0),
			source: realTimeLayer.getSource(),//设置查询的图层
			property: 'Id'
		});

		// Popup overlay
		var popup = new ol.Overlay.Popup (
		{	popupClass: "default", //"tooltips", "warning" "black" "default", "tips", "shadow",
			closeBox: true,
			onclose: function(){ console.log("关闭窗口!"); },
			positioning: 'auto',
			autoPan: true,
			autoPanAnimation: { duration: 100 },
			id:'1'
		});
		var format = 'image/jpeg';
		// map
	    editor = new ol.Editor({
	    	overlays:[popup],
	        target: 'map',
	        view: new ol.View({
	            //projection: 'EPSG:4326',
	            extent: [13582065, 3587358,13585174, 3588706],
	            center: [13583806.359,3588119.431],
	            zoom: 14,
	            minZoom: 12,
                maxZoom: 23,
                rotation:-15*Math.PI/180.0
	        }),
	        layers: [
	            // new ol.layer.Tile({
	            //     name: 'OpenStreetMap',
	            //     source: new ol.source.OSM()
	            // }),
			 //   new ol.layer.Image({
    //         	name:'洋山港-设备',
				// source: new ol.source.ImageWMS({
				// 	url: MapServerIP+'ysg/wms',
				// 	params: {'LAYERS': 'ysg:total','VERSION':'1.1.0'},
				// 	serverType: 'geoserver',
		  //    	 })
				// }),
	            new ol.layer.Image({
	            	name:'洋山港-边界',
					source: new ol.source.ImageWMS({
						url:'http://localhost:8080/geoserver/ysg/wms',
						params: {'LAYERS': 'ysg:bound','VERSION':'1.1.0'}
	         	 })
				}),
				 new ol.layer.Image({
	            	name:'洋山港-集装箱',
					source: new ol.source.ImageWMS({
						url: 'http://localhost:8080/geoserver/ysg/wms',
						params: {'LAYERS': 'ysg:container','VERSION':'1.1.0'},
						serverType: 'geoserver',
	         	 })
				}),
				//  new ol.layer.Tile({
				//         visible: false,
				//         source: new ol.source.TileWMS({
				//           url: 'http://localhost:8080/geoserver/ysg/wms',
				//           params: {'FORMAT': format, 
				//                    'VERSION': '1.1.0',
				//                    tiled: true,
				//                 STYLES: '',
				//                 LAYERS: 'ysg:container',
				//              tilesOrigin: 13582132.823772825 + "," + 3587341.8755370886
				//           }
				//         })
				//       }),
				//   new ol.layer.Image({
	   //          	name:'洋山港-道路',
				// 	source: new ol.source.ImageWMS({
				// 		url: MapServerIP+'ysg/wms',
				// 		params: {'LAYERS': 'ysg:road','VERSION':'1.1.0'},
				// 		serverType: 'geoserver',
	   //       	 })
				// }),
				//    new ol.layer.Image({
	   //          	name:'洋山港-设备',
				// 	source: new ol.source.ImageWMS({
				// 		url: MapServerIP+'ysg/wms',
				// 		params: {'LAYERS': 'ysg:shebei','VERSION':'1.1.0'},
				// 		serverType: 'geoserver',
	   //       	 })
				// }),

				realTimeLayer
				// bridgeCraneLayer,
				// gantryCraneLayer,
				// trackCraneLayer,
				// carsLayer,
				// camerasLayer

	        ],
	        //地图控件加载
	        controls: [
	        	//new ol.control.MenuBars(),
	        	new ol.control.Exit(),
	        	//new ol.control.Condition(),
	        	//new ol.control.Alarm(),
	        	new ol.control.MapTools(),
	        	//new ol.control.FullScreen(),
	            //new ol.control.Rotate(),
	            new ol.control.ScaleLine(),
	            //new ol.control.ZoomSlider(),
	            //new ol.control.Attribution({ collapsible: false }),
	            new ol.control.LayerManager({ target: 'layermanager' }),
	            //attributeManager,
	            //new ol.control.Zoom({ target: 'maptools',zoomOutLabel:'', zoomInTipLabel:'放大',zoomOutTipLabel:'缩小' }),
	            //new ol.control.Zoom({ target: 'maptools', zoomInLabel: ' ', zoomOutLabel: ' ',zoomInTipLabel:'放大',zoomOutTipLabel:'缩小' }),
	           // new ol.control.ZoomHistory({ target: 'maptools' , backTipLabel:'向前',nextTipLabel:'向后'}), 
	            //new ol.control.ZoomToExtent({ target: 'maptools', label: ' ',tipLabel:'全局' ,extent: eov.getExtent()}),
	            //new ol.control.ZoomToSelection({ target: 'maptools' }),
	            //new ol.control.SelectionControls({ target: 'maptools' }),
	            //new ol.control.Measure({ target: 'maptools' }),
	            new ol.control.Message({ target: 'statusbar' }),
	            //new ol.control.QueryField({target:'statusbar'}),
	            new ol.control.MousePosition({
	                target: 'statusbar',
	                className: 'ol-mouse-position ol-control ol-unselectable',
	                coordinateFormat: ol.coordinate.createStringXY(3)
	            }),

	            new ol.control.Rotation({ target: 'statusbar'}),
	            new ol.control.Projection({
	                target: 'statusbar',
	                projections: ['EPSG:3857']
	            }),
	           // search,
	            //new ol.control.Alarm({target:'equipments'}),
	            //new ol.control.Route({target:'equipments'}),
	            //new ol.control.Equipments({target:'equipments'}),
	            //new ol.control.RealTime({target:'equipments'})
	        ],
	        loadTilesWhileAnimating: true,
	        loadTilesWhileInteracting: true,
	        logo: false
	    });
		//加载实时数据
		//receiveData();
	    //地图加载时，操作
	    var showing = false;
	    // Select feature when click on the reference index
	    // var select = new ol.interaction.Select({});
	    editor.addInteraction(select);
	    //On selected => show/hide popup
	    select.getFeatures().on(['add'], function(e)
	    {	
	    	var feature = e.element;
	    	OutlineInfo(feature);
	    })
	    select.getFeatures().on(['remove'], function(e)
	    {	popup.hide(); 
	    })
	    search.on('select', function(e)
	    {	
	    	var feature=e.search;
	    	OutlineInfo(feature);
	    });

	    $(document).ready(function() {
	    	//关闭右键功能
	        $(document).bind("contextmenu",function(e){
	               return false;
	           });
	        //tooltip
	        $('#toolbar [title], #map [title], #statusbar [title]').tooltip({
	            placement: 'auto bottom',
	            container: 'body'
	        });
	        //通过URL获取参数，并执行相应的操作
	  		var myurl=GetQueryString("minx");
			if(myurl !=null)
			{
			   var userID=GetQueryString('userID');
			   var minx=GetQueryString('minx');
			   var miny=GetQueryString('miny');
			   var maxx=GetQueryString('maxx');
			   var maxy=GetQueryString('maxy');
			   editor.getView().fit([minx,miny,maxx,maxy]);
			}
	    });
		</script>
	</body>
</html>